<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Home - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <li class="nav-link nav-home-link"><a href="index.html">Home</a></li><li class="nav-heading">Classes</li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="FacebookCrawler.html">FacebookCrawler</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="FacebookCrawler.html#.resolveResponse">resolveResponse</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="FacebookCrawler.html#.searchAndSaveFBPages">searchAndSaveFBPages</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="GraphQLScalarType.html">GraphQLScalarType</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="GraphQLScalarType.html#.parseLiteral">parseLiteral</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="GraphQLScalarType.html#.parseValue">parseValue</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="GraphQLScalarType.html#.serialize">serialize</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="module-ForeignCode-Java.html">Java</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-ForeignCode-Java.html#.call">call</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-ForeignCode-Java.html#.callSync">callSync</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-ForeignCode-Java.html#.data">data</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-ForeignCode-Java.html#.kill">kill</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="module-ForeignCode-Python.html">Python</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-ForeignCode-Python.html#.call">call</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-ForeignCode-Python.html#.callSync">callSync</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-ForeignCode-Python.html#.data">data</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-ForeignCode-Python.html#.kill">kill</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="module-ForeignCode-R.html">R</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-ForeignCode-R.html#.call">call</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-ForeignCode-R.html#.callSync">callSync</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-ForeignCode-R.html#.data">data</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-ForeignCode-R.html#.kill">kill</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="SentimentWorker.html">SentimentWorker</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="SentimentWorker.html#.detectSentiments">detectSentiments</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="SentimentWorker.html#.start">start</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="SentimentWorker.html#.stop">stop</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="TopicWorker.html">TopicWorker</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="TopicWorker.html#.detectTopics">detectTopics</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="TopicWorker.html#.start">start</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="TopicWorker.html#.stop">stop</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="TwitterCrawler.html">TwitterCrawler</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="TwitterCrawler.html#.start">start</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="TwitterCrawler.html#.track">track</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="TwitterCrawler.html#.updateTweetAuthors">updateTweetAuthors</a></span></li><li class="nav-heading">Modules</li><li class="nav-heading"><span class="nav-item-type type-module">M</span><span class="nav-item-name"><a href="module-Connectors.html">Connectors</a></span></li><li class="nav-heading"><span class="nav-item-type type-module">M</span><span class="nav-item-name"><a href="module-Export.html">Export</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-Export.html#~convertSequelizeModelToCsv">convertSequelizeModelToCsv</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-Export.html#~convertToCsvRaw">convertToCsvRaw</a></span></li><li class="nav-heading"><span class="nav-item-type type-module">M</span><span class="nav-item-name"><a href="module-ForeignCode.html">ForeignCode</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-ForeignCode.html#~JavaShell">JavaShell</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-ForeignCode.html#~PythonShell">PythonShell</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-ForeignCode.html#~RShell">RShell</a></span></li><li class="nav-heading"><span class="nav-item-type type-module">M</span><span class="nav-item-name"><a href="module-Logger.html">Logger</a></span></li><li class="nav-heading"><span class="nav-item-type type-module">M</span><span class="nav-item-name"><a href="module-LogginMiddleware.html">LogginMiddleware</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-LogginMiddleware.html#~loggingMiddleware">loggingMiddleware</a></span></li><li class="nav-heading"><span class="nav-item-type type-module">M</span><span class="nav-item-name"><a href="module-ML_Wrapper.html">ML_Wrapper</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-ML_Wrapper.html#.detectSentimentJavaNB">detectSentimentJavaNB</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-ML_Wrapper.html#~detectSarcasm">detectSarcasm</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-ML_Wrapper.html#~detectSarcasmSync">detectSarcasmSync</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-ML_Wrapper.html#~detectSentimentEnsemblePython">detectSentimentEnsemblePython</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-ML_Wrapper.html#~detectSentimentEnsemblePythonSync">detectSentimentEnsemblePythonSync</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-ML_Wrapper.html#~detectSentimentEnsembleR">detectSentimentEnsembleR</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-ML_Wrapper.html#~detectSentimentEnsembleRSync">detectSentimentEnsembleRSync</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-ML_Wrapper.html#~detectTopicCTMDynamic">detectTopicCTMDynamic</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-ML_Wrapper.html#~detectTopicLDADynamic">detectTopicLDADynamic</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-ML_Wrapper.html#~detectTopicLDAStatic">detectTopicLDAStatic</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-ML_Wrapper.html#~detectTopicLDAStaticBatch">detectTopicLDAStaticBatch</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-ML_Wrapper.html#~detectTopicLDAStaticSync">detectTopicLDAStaticSync</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-ML_Wrapper.html#~detectTrends">detectTrends</a></span></li><li class="nav-heading"><span class="nav-item-type type-module">M</span><span class="nav-item-name"><a href="module-Sockets.html">Sockets</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-Sockets.html#~listenToSockets">listenToSockets</a></span></li><li class="nav-heading"><span class="nav-item-type type-module">M</span><span class="nav-item-name"><a href="module-Utils.html">Utils</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-Utils.html#~buildCommonTopicHeader">buildCommonTopicHeader</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-Utils.html#~commonTopicHeader">commonTopicHeader</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-Utils.html#~extractHashTagsFromString">extractHashTagsFromString</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-Utils.html#~extractHashtagsFromTweet">extractHashtagsFromTweet</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-Utils.html#~getKeyword">getKeyword</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-Utils.html#~occurrences">occurrences</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-Utils.html#~stripHTMLTags">stripHTMLTags</a></span></li><li class="nav-heading"><a href="global.html">Globals</a></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#resolvers">resolvers</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#typeDefinitions">typeDefinitions</a></span></li>
</nav>

<div id="main">
    

    



    









    


    <section class="readme">
        <article><h1 id="sentitomo">SentiTomo</h1>
<h1 id="table-of-contents">Table of Contents</h1>
<ul>
<li><a href="#sentitomo">SentiTomo</a></li>
<li><a href="#table-of-contents">Table of Contents</a><ul>
<li><a href="#idea">Idea</a></li>
<li><a href="#problem-statement-and-way-to-go">Problem statement and way to go</a></li>
<li><a href="#fundamental-technologies">Fundamental technologies</a><ul>
<li><a href="#nodejs-server">Node.js (Server)</a></li>
<li><a href="#yarn-server-and-client">Yarn (Server and Client)</a></li>
<li><a href="#expressjs-server">Express.js (Server)</a></li>
<li><a href="#h20-server">h20 (Server)</a></li>
<li><a href="#graphql-server-api">GraphQL (Server API)</a></li>
<li><a href="#react-client---front-end">React (Client - Front-End)</a></li>
</ul>
</li>
<li><a href="#the-application">The Application</a><ul>
<li><a href="#overview">Overview</a></li>
<li><a href="#installation">Installation</a><ul>
<li><a href="#1-install--nodejs-and-npm">1. Install  Node.js and npm</a></li>
<li><a href="#install-yarn-optional">Install Yarn (optional)</a></li>
<li><a href="#install-dependencies">Install dependencies</a></li>
<li><a href="#install-java-version-6-and-8">Install Java Version 6 and 8</a></li>
<li><a href="#install-python-and-dependencies">Install Python and dependencies</a></li>
<li><a href="#install-r">Install R</a></li>
<li><a href="#set-up-environment-variables">Set up environment variables</a></li>
<li><a href="#build-the-client-application">Build the client application</a></li>
<li><a href="#start-the-server">Start the server</a></li>
</ul>
</li>
<li><a href="#database">Database</a></li>
<li><a href="#server">Server</a><ul>
<li><a href="#ml">ML</a><ul>
<li><a href="#preface-important-notice">Preface (Important Notice)</a></li>
<li><a href="#r">R</a></li>
<li><a href="#python">Python</a></li>
<li><a href="#java">Java</a></li>
</ul>
</li>
<li><a href="#data">data</a></li>
</ul>
</li>
<li><a href="#client">Client</a><ul>
<li><a href="#static-view">Static view</a></li>
<li><a href="#toolbox-view">Toolbox view</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sequence-diagrams">Sequence Diagrams</a></li>
<li><a href="#conclusion">Conclusion</a></li>
<li><a href="#questions">Questions</a></li>
</ul>
</li>
</ul>
<p>As part of our Master Team Project &quot;Topic Monitoring in the Pharmaceutical Industry&quot; we wanted to develop an application to incorporate our findings and different machine learning scripts to show how a production environment can look like. The name of this application is &quot;SentiTomo&quot;, a combination of the words &quot;Sentiment Analysis&quot; and &quot;Topic Monitoring&quot;.</p>
<h2 id="idea">Idea</h2>
<p>The basic idea of accomplish such an task was to create a client-server architecture. The server part will be responsible for crawling social media data from Twitter and Facebook, as well as executing different machine learning tasks, such as sentiment analysis (classification ), topic detection and trend detection (clustering). Besides this, the results of those tasks are saved in a database to be available through an Application Programming Interface (API). This ensures that the results are persisted over time and can be accessed in an easy way.</p>
<h2 id="problem-statement-and-way-to-go">Problem statement and way to go</h2>
<p>Throughout our work on this project we tried out various algorithms for machine learning (ML) and implemented them in different programming languages. After filtering all good performing algorithms we ended up with three programming languages:  R, Python and Java. The resulting problem now was to find a common platform for the server to work with those languages. The initial attempt to solve this issue was to choose one those language as the primary one and let it work with the others. But this had one drawback. If we would have chosen one of the ML languages as the primary one we would have not been able to replace this language anymore in favor of another one in which some models may perform better. This would lead to an abandoned machine learning language just serving as a wrapper language. So we were searching for a language which not perform any machine learning but is capable of working with all the existing languages. This ensures that the different languages, and machine learning scripts can easily be switched out or updated without influencing other parts of the application because those will always interact with the wrapper language which copes with the different languages.
Because of the rising popularity and the possibility to be run on server and client side we chose JavaScript as our wrapper language. With the open-source and community driven framework called 'Node.js' it is possible to create powerful server and client applications. Furthermore it is possible to easily spawn child processes, invoking other programming languages, and communicate with them. This made JavaScript our way to go wrapper language.
Based on this, we want to provide you an overview about the main technologies which we used to built up the application, how the application is structured and how it eventually can be used in a production environment.</p>
<h2 id="fundamental-technologies">Fundamental technologies</h2>
<p>To give you an idea which technologies were used throughout the development process of SentiTomo this chapter gives an overview about the most prominent ones. We tried to only use frameworks which experience a high support from the developer community as well as developed by reliable sources. This section should not give an exhaustive explanation of all the used framework. Much more it should give a hint on why we chose the different solutions for our application. </p>
<h3 id="node-js-server-">Node.js (Server)</h3>
<p><a href="https://nodejs.org/en/">Node.js</a> is an open-source, cross-platform framework written in C, C++ and JavaScript, which makes it possible to run JavaScript code on the server-side. The initial release was on May the 27th, 2009 and it was written by Ryan Dahl. Primarily it was built because the most common web server at this time, Apache HTTP Server, had troubles with a lot of concurrent connections and normally used blocking code executions which led to poor server performance.
The idea behind Node is to utilize a simplified event-driven programming paradigm where the program flow is determined by events (user clicks, messages from other methods etc.) to let so called callback functions take care of the result of method calls. With this structure the main thread of a Node.js application is not blocked by method executions. Normally a Node based application is only running on one thread, but with non-blocking method calls it will never gets stuck at one point. This makes it easy to build highly scalable applications without the need of multiple threads, which could result into poor performance. But if it is needed Node can also spawn different threads and is not limited to only one.
Hand in hand to Node comes a package manager called <code>npm</code> which stands for <code>Node Package Manager</code>. It is used to install, update and remove third party Node.js programs which are listed in the npm registry. npm enables developers to easily share and distribute Node.js code, so it can be used in other projects. All installed dependencies are listed inside a file called <code>package.json</code> which is mandatory for every Node based project. It contains all necessary information about the different packages and their version numbers. These are installed inside a folder called <code>node_modules</code>, which is accessed at runtime to load the different dependencies of a Node application.</p>
<h3 id="yarn-server-and-client-">Yarn (Server and Client)</h3>
<p><a href="https://yarnpkg.com/lang/en/">Yarn</a> is an additional Node package manager built by Facebook based on npm, which improves npm in some important parts. One of the biggest flaws of <code>npm</code> is that it stores the different packages inside the <code>node_modules</code> in a non deterministic way. That means that the order of packages inside <code>node_modules</code> can differ from user to user depending on the order of installation. This can lead to bugs like 'Works on my machine' arise very quickly which makes debugging and hunting bugs down very frustrating. Also the the actual dependency tree can differ from the <code>node_modules</code> directory because duplicate dependencies are merged by Node itself. All these issues are solved with Yarn by installing dependencies in a deterministic way and organizing duplicate ones in a better manner. Every projects that uses Yarn file called <code>yarn.lock</code> is created. This file is used to execute the installation processes on different machines in the exact same way which makes bugs like 'Works on my machine' very unlikely.</p>
<h3 id="express-js-server-">Express.js (Server)</h3>
<p><a href="https://expressjs.com/">Express.js</a> is a JavaScript framework built with Node.js and today the de-facto standard to build a web-server application with Node. It is MIT licensed, open-source and published directly from the developers of Node.js.
In its fundamental form it is very lightweight and only offers the minimum functionalities to build a web-server. But it offers great ways to integrate all kind of plugins, like logging, templating engines, server side rendering, and even more. This makes it very versatile and the number one solution for developing a web server with Node.js. Therefore we chose it as the framework to build our server architecture.</p>
<h3 id="h20-server-">h20 (Server)</h3>
<p><a href="https://www.h2o.ai/">h20</a> is a software platform for big-data analysis and machine learning tasks. It can be run in Java, R and Python and offers APIs for building and using models for detection patterns in data. Inside SentiTomo it is used in the R versions and serves as a platform for running some machine learning tasks on it. Primarily these are sentiment analysis tasks.</p>
<h3 id="graphql-server-api-">GraphQL (Server API)</h3>
<p>Because we wanted to integrate an Application Programming Interface for easy data sharing between server and client we searched for a state of the art solution and came up with <a href="http://graphql.org/learn/">GraphQL</a>. It is the definition for the combination of two things. On the one hand it is a query language for any existing API/connection to a database and on the other hand it is an server-side runtime for executing queries that are defined by a type system based on data from any back end storage. It is actively maintained by the the open-source community, created by Facebook and said to be next big thing after REST.
The major key part of  GraphQL is that it  can be set up on any database management system (DBSM), like on SQL-based or document based ones. It is not bound to any specific programming language nor to any server implementation. It is completely decoupled from those, which makes it easy to integrate in any existing system. Another advantage is, that it does not dictate your back end storage option. This makes it possible to easily switch the back end without affecting the existing API. But one of the most impressing parts is, that it solves a big issue we had with REST. When querying an instance in REST, this very often ended up with multiple queries to different endpoints, while with GraphQL this can be accomplished with only one request. 
For example in our use case: A query for an tweet and the corresponding author of the tweet in REST would normally result in two calls. One to the tweet endpoint and one the author endpoint. With an GraphQL based API the request can be fulfilled with only one call:</p>
<p>A GraphQL service is defined by its <code>type definitions</code>. A sample one would look like the following: </p>
<pre class="prettyprint source"><code>type Query {
  tweet: Tweet
}

type Tweet {
  id: ID
  message: String
  author: Author
}

type Author {
  id: ID
  name: String
}</code></pre><p>Type definitions are like a schema for the API. They define which type requests are accepted by API. </p>
<p>So called <code>resolvers</code> then take care of the actual database call to get the instances needed. </p>
<pre class="prettyprint source"><code>function Query_tweet(request) {
  return database.getTweet();
}

function Tweet_message(tweet) {
  return tweet.getMessage();
}

function Tweet_author(tweet) {
  return tweet.getAuthor();
}</code></pre><p>An example request to the API could be:</p>
<pre class="prettyprint source"><code>{
    tweet{
        id
        message
        author{
            id
            name
        }
    }
}</code></pre><p>Response:</p>
<pre class="prettyprint source"><code>{
    data: {
        tweet: {
            id: 123456789
            message: &quot;This is a test&quot;
            author: {
                id: 1
                name: &quot;John Doe&quot;
            }
        }
    }
}</code></pre><p>With this example it is very clear to see that it is possible to easily request only the data we want and do this with only one API request. This and the fact that GraphQL can work with any programming language, any server implementation and the option to completely switch out the DBMS if needed, we chose it as our standard API runtime.</p>
<h3 id="react-client-front-end-">React (Client - Front-End)</h3>
<p>To develop our front-end client side we wanted to use a modern, well supported and written framework and found the best solution in <a href="https://facebook.github.io/react/">React</a>. React is an open source front-end JavaScript library for dynamically creating user interfaces. It is very actively maintained by Facebook and the open source community and offers a variety of additional packages which can be used to extend the functionalities of it. Currently it is available in version 15 with version 16 at beta state. A lot of big companies are building their web application based on it. One of the most prominent ones are AirBnB, Netflix and Facebook itself. </p>
<p>React uses a special JavaScript syntax called <code>.jsx</code>. With that it is possible to write HTML code inside a JavaScript file. A simple hello world <code>.jsx</code> example file looks like this:</p>
<pre class="prettyprint source"><code>import * as React from 'react';

class App extends React.Component {
   render() {
      return (
         &lt;div>
               &lt;p>Header&lt;/p>
               &lt;p>Content&lt;/p>
               &lt;p>Footer&lt;/p>
         &lt;/div>
      );
   }
}

export default App;</code></pre><p>As we see inside the <code>render</code> method of this class we can write pure HTML code without breaking the code. React in the end renders this HTML dynamically to the Virtual Document Object Model (Virtual DOM) which is another notable feature of React. Instead of rendering directly to the HTML DOM it caches all changes inside the virtual DOM and updates the browsers displayed DOM accordingly in a efficient way.
React always tries to work with a component oriented way of structuring a front-end. For example a sidebar navigation is one component. Inside this component multiple link components are nested. This makes React projects very structured and good to maintain if some features need to be added. 
React is in our eyes one of the most versatile tool for developing dynamic front-ends which makes it the best fit for creating the client part of SentiTomo.</p>
<h2 id="the-application">The Application</h2>
<p>Due to the fact that SentiTomo is built up with different technologies, there are some requirements that need to be fulfilled when you are trying to set up the application. To clarify the different environment settings and the overall structure the next section tries to discuss all of those facts.</p>
<h3 id="overview">Overview</h3>
<p>The directory structure of the application can be seen in the following: (<em>without files except package.json and yarn.lock</em>):</p>
<pre class="prettyprint source"><code>.
├── client
│   ├── package.json
│   ├── build
│   ├── public
│   ├── src
│   │   ├── components
│   │   ├── data
│   │   ├── fonts
│   │   ├── layouts
│   │   ├── styles
│   │   └── tests
│   └── yarn.lock
└── server
    ├── ML
    │   ├── Java
    │   ├── Python
    │   ├── R  
    ├── data
    ├── middlewares
    ├── package.json
    ├── service
    └── yarn.lock</code></pre><p>SentiTomo is divided into two parts, client and server. The main entry point of the application (<code>/server/server.js</code>) lies in the server directory which is starting up the Node.js server process and serving files form the build directory of the client. Before we have a deeper look into the different directories we first introduce you the installation process of SentiTomo.</p>
<h3 id="installation">Installation</h3>
<p>The main steps to install SentiTomo are:</p>
<ol>
<li>Install Node.js and npm</li>
<li>Install Yarn (optional)</li>
<li>Install dependencies</li>
<li>Install Java Version 6 an 8 </li>
<li>Install Python Version 3 </li>
<li>Install R</li>
<li>Set up environment variables</li>
<li>Build the client application</li>
<li>Start the server</li>
</ol>
<h4 id="1-install-node-js-and-npm">1. Install  Node.js and npm</h4>
<p>Node.js always comes in combination with it's packaging manager npm . It can be installed on any common OS, and therefore you can use nearly any server operating system you like. SentiTomo was built on MacOS X Sierra Version 10.12.6 so we suggest using a Unix based server here. To install Node you can either use the downloads provided by the <a href="https://nodejs.org/en/download/">Node website</a> or using one of the following approaches.</p>
<p><strong>MacOS:</strong></p>
<p>Using <a href="https://brew.sh/">homebrew</a>:</p>
<pre class="prettyprint source"><code>$ brew install node</code></pre><p><strong>Linux:</strong></p>
<p>On Linux there are plenty of different installation possibilities but here we suggest to use the ones provided on the <a href="https://nodejs.org/en/download/package-manager/">Node website</a>.</p>
<h4 id="install-yarn-optional-">Install Yarn (optional)</h4>
<p>After installing Node it comes to the decision to either stay with npm as your desired dependency manager or additionally install Yarn. If you decide to go with yarn this has the advantage that you will get exact the same dependency version as we had while testing SentiTomo. This is ensured by the  <code>yarn.lock</code> files. This is a non-mandatory step but when you are using npm it can be the case that you will get a slightly different dependency tree than with yarn.</p>
<p> Yarn is installed via npm with the following command.</p>
<pre class="prettyprint source"><code>$ sudo npm install -g yarn # use sudo to ensure yarn is on your path</code></pre><h4 id="install-dependencies">Install dependencies</h4>
<p>Now that either npm or Yarn is set up we can use it to install the dependencies. The following commands assume that you are in the top level <code>sentitomo/</code> of the application.</p>
<p><strong>npm:</strong></p>
<pre class="prettyprint source"><code>$ # install top level dependencies
$ npm install
$ # install server dependencies
$ cd server
$ npm install

$ # install client dependencies
$ cd ../client
$ npm install</code></pre><p><strong>Yarn:</strong></p>
<pre class="prettyprint source"><code>$ # install top level dependencies
$ yarn install
$ # install server dependencies
$ cd server
$ yarn install

$ # install client dependencies
$ cd ../client
$ yarn install</code></pre><h4 id="install-java-version-6-and-8">Install Java Version 6 and 8</h4>
<p>Some of the R scripts we use for machine learning need both versions of Java to work. To install the versions just follow the basic instructions of your specified distribution. You just have to ensure that the user who executes the Node process has access to both libraries.</p>
<h4 id="install-python-and-dependencies">Install Python and dependencies</h4>
<p>The Python scripts for topic detection are based on Python version 2 and 3. Follow the common ways to install it on your server OS and ensure that <code>python</code> is the command to execute Python 2 and <code>python3</code> to execute Python 3 on the terminal. </p>
<p><strong>Dependencies</strong></p>
<p>Before you can run the Python files you have to ensure that all of the following modules are installed. Install module via <code>pip3 install &lt;moduleName&gt;</code> for Python 3 modules and <code>pip2 install &lt;moduleName&gt;</code> for Python 2 modules</p>
<p><em>Python3 modules</em></p>
<pre class="prettyprint source"><code>$ pip3 freeze
boto==2.48.0
bz2file==0.98
certifi==2017.4.17
chardet==3.0.4
cycler==0.10.0
datetime-truncate==1.0.1
funcy==1.8
future==0.16.0
gensim==2.3.0
gnip-trend-detection==0.5
idna==2.5
Jinja2==2.9.6
joblib==0.11
MarkupSafe==1.0
matplotlib==2.0.2
nltk==3.2.4
numexpr==2.6.2
numpy==1.13.1
pandas==0.20.3
py==1.4.34
pyLDAvis==2.1.1
pyparsing==2.2.0
pytest==3.1.3
python-dateutil==2.6.1
pytz==2017.2
requests==2.18.2
scikit-learn==0.18.2
scipy==0.19.1
six==1.10.0
sklearn==0.0
smart-open==1.5.3
textblob==0.12.0
urllib3==1.22</code></pre><p><em>Python2 modules</em></p>
<pre class="prettyprint source"><code>$ pip freeze
altgraph==0.10.2
astroid==1.5.3
backports.functools-lru-cache==1.4
bdist-mpkg==0.5.0
bonjour-py==0.3
boto==2.48.0
bz2file==0.98
certifi==2017.4.17
chardet==3.0.4
configparser==3.5.0
enum34==1.1.6
gensim==2.3.0
idna==2.5
isort==4.2.15
lazy-object-proxy==1.3.1
macholib==1.5.1
matplotlib==1.3.1
mccabe==0.6.1
modulegraph==0.10.4
nltk==3.2.4
numpy==1.13.1
pandas==0.20.3
py2app==0.7.3
pylint==1.7.2
pyobjc-core==2.5.1
pyobjc-framework-Accounts==2.5.1
pyobjc-framework-AddressBook==2.5.1
pyobjc-framework-AppleScriptKit==2.5.1
pyobjc-framework-AppleScriptObjC==2.5.1
pyobjc-framework-Automator==2.5.1
pyobjc-framework-CFNetwork==2.5.1
pyobjc-framework-Cocoa==2.5.1
pyobjc-framework-Collaboration==2.5.1
pyobjc-framework-CoreData==2.5.1
pyobjc-framework-CoreLocation==2.5.1
pyobjc-framework-CoreText==2.5.1
pyobjc-framework-DictionaryServices==2.5.1
pyobjc-framework-EventKit==2.5.1
pyobjc-framework-ExceptionHandling==2.5.1
pyobjc-framework-FSEvents==2.5.1
pyobjc-framework-InputMethodKit==2.5.1
pyobjc-framework-InstallerPlugins==2.5.1
pyobjc-framework-InstantMessage==2.5.1
pyobjc-framework-LatentSemanticMapping==2.5.1
pyobjc-framework-LaunchServices==2.5.1
pyobjc-framework-Message==2.5.1
pyobjc-framework-OpenDirectory==2.5.1
pyobjc-framework-PreferencePanes==2.5.1
pyobjc-framework-PubSub==2.5.1
pyobjc-framework-QTKit==2.5.1
pyobjc-framework-Quartz==2.5.1
pyobjc-framework-ScreenSaver==2.5.1
pyobjc-framework-ScriptingBridge==2.5.1
pyobjc-framework-SearchKit==2.5.1
pyobjc-framework-ServiceManagement==2.5.1
pyobjc-framework-Social==2.5.1
pyobjc-framework-SyncServices==2.5.1
pyobjc-framework-SystemConfiguration==2.5.1
pyobjc-framework-WebKit==2.5.1
pyOpenSSL==0.13.1
pyparsing==2.0.1
python-dateutil==1.5
pytz==2013.7
requests==2.18.2
scikit-learn==0.18.2
scipy==0.19.1
singledispatch==3.4.0.3
six==1.10.0
smart-open==1.5.3
textblob==0.12.0
urllib3==1.22
wrapt==1.10.10
xattr==0.6.4
yapf==0.16.3
zope.interface==4.1.1</code></pre><p>During the execution a proportion of our scripts throw deprecation warnings. These are only thrown for information purposes, they will not influence the execution of the code. </p>
<p>Some of the  Python scripts are using the <code>Natural language toolkit (NLTK)</code> to preprocess messages, detect the sentiment or the topic of those, based on corpora, tokenizers, lexica etc. . In order to use this it is mandatory to copy the folder <code>nltk_data</code> (can be found in <code>sentitomo/</code>), to the home directory of the user who is running the application. Afterwards it can be removed from the <code>sentitomo/</code> directory.</p>
<p>On MacOS:</p>
<pre class="prettyprint source"><code>/usr/&lt;username>/nltk_data</code></pre><p>On Linux:</p>
<pre class="prettyprint source"><code>/home/&lt;username>/nltk_data</code></pre><p>On Windows Vista,7,8,10</p>
<pre class="prettyprint source"><code>&lt;root>\Users\&lt;username>\nltk_data</code></pre><h4 id="install-r">Install R</h4>
<p><em>MacOS:</em></p>
<p>On MacOS we suggest using the <code>.pkg</code> file from the <a href="https://cran.r-project.org/bin/macosx/">r-project site</a> to install R.</p>
<p><em>Linux:</em></p>
<p>The same way applies for Linux, please have a look at the <a href="https://cran.r-project.org/bin/macosx/">r-project site</a> to install R.</p>
<p><em>Windows:</em></p>
<p>The same way also applies for Windows, please have a look at the <a href="https://cran.r-project.org/bin/macosx/">r-project site</a> to install R.</p>
<h4 id="set-up-environment-variables">Set up environment variables</h4>
<p>SentiTomo is using some environment variables to connect to different services which are necessary to run the application. These variables are stored inside the <code>.env</code> file.  <strong>Be aware to never add <code>.env</code> to your VCS</strong></p>
<p><em>Database</em></p>
<p>Our application is using a MySQL database as it's back end. To use your database you have to modify the <code>.env</code> file in the root of <code>sentitomo/server</code>. This file is used for setting up some configuration settings. Just fill out the following key/value pairs to connect your database.</p>
<pre class="prettyprint source"><code>DB_NAME=yourDBName
DB_USER=yourDBUser
DB_PASS=userPassword
DB_HOST=hostURL</code></pre><p><em>When the application is connected to the first time it will create the mandatory table structure in your database automatically.</em> </p>
<p><em>Twitter</em></p>
<p>In order have access to the Twitter Streaming API you have to obtain your client credentials by creating a new Twitter APP on the <a href="https://apps.twitter.com/app/new">Twitter Dev Website</a>. After doing so, also save your credentials in the <code>.env</code> file:</p>
<pre class="prettyprint source"><code>TWITTER_CONSUMER_KEY=yourConsumerKey
TWITTER_CONSUMER_SECRET=yourConsumerSecret
TWITTER_ACCESS_TOKEN_KEY=yourAccessTokenKey
TWITTER_ACCESS_TOKEN_SECRET=yourAccessTokenSecret</code></pre><p>It is also possible to change the filters which are used to crawl the Twitter API here. A comma indicates an OR and a whitespace an AND concatenation.</p>
<pre class="prettyprint source"><code>TWITTER_STREAMING_FILTERS=&quot;YOURFILTERS&quot;</code></pre><p>Examples: </p>
<ul>
<li><code>&quot;humira,abbvie&quot;</code> crawls all tweets that contain <code>humira OR abbvie</code> </li>
<li><code>&quot;humira abbvie&quot;</code> crawls all tweets that contain <code>humira AND abbvie</code></li>
</ul>
<p><em>Facebook</em></p>
<p>Because we dropped Facebook during our project the functionally to crawl data from it is only implemented with a temporary API key. To create such an key visit: <a href="https://developers.facebook.com/tools/explorer/">Facebook Graph Explorer</a> and generate a new user API key. Copy this key and insert it into:</p>
<pre class="prettyprint source"><code>FACEBOOK_API_KEY=yourKeyHere</code></pre><p>After setting this up it possible to crawl data from Facebook for around 1-2 hours. After that time period the key needs to be renewed manually.</p>
<p>SentiTomo is only able to manually crawl Facebook pages based on keywords. There is not automatic stream of new data. To narrow down the results of those crawls to the pharmaceutical context there is a category filter set in <code>.env</code>. To change it just edit the following line:</p>
<pre class="prettyprint source"><code>FACEBOOK_PAGE_CATEGORY_FILTER=&quot;Medical Company,Pharmaceuticals,Biotechnology Company,Medical & Health,Community,Interest&quot;</code></pre><h4 id="build-the-client-application">Build the client application</h4>
<p>If you do not see a <code>build</code> folder inside <code>client</code> be sure to execute the following command to make the front end static. Only then it can be served from our server application.</p>
<pre class="prettyprint source"><code>$ cd client
$ yarn build</code></pre><h4 id="start-the-server">Start the server</h4>
<p>After installing all necessary software fragments and building the client application you just need to start the server with the following command, assuming you are in the <code>sentitomo/server</code> directory:</p>
<pre class="prettyprint source"><code>$ npm start
#or 
$ yarn start</code></pre><p>After starting the server it is listening on Port:8080.
If you test locally then visit:</p>
<ul>
<li>Front-End: <a href="localhost:8080/app/dashboard">localhost:8080/app/dashboard</a> </li>
<li>GraphQL Endpoint:  <a href="localhost:8080/graphql">localhost:8080/graphql</a> </li>
<li>Endpoint for testing the API: <a href="localhost:8080/graphiql">localhost:8080/graphiql</a></li>
</ul>
<p>If you want to access the server from a remote destination just switch out localhost with your server IP or domain.</p>
<p>Once the server is started four methods are executed:</p>
<ul>
<li><code>JavaShell('h20.jar').call()</code></li>
<li><code>SentimentWorker.start()</code></li>
<li><code>TopicWorker.start()</code></li>
<li><code>TwitterCrawler.start()</code></li>
</ul>
<p>The first one will start the h20 platform which is needed by some machine learning tasks. It starts a second webserver at <code>localhost:54321</code>.</p>
<p>The second and third one will continuously search for tweets which do not have sentiment or topic assigned to them, and will detect those. The last one will crawl the Twitter streaming API based on the keywords specified inside the <code>.env</code> file and save them into the database. The whole startup sequence and the workflow of the workers can also be found displayed in the <a href="#sequence-diagrams">sequence diagrams section</a>. All of these workers are executed asynchronously, so they do not influence or block each other. </p>
<p>In the next part we will have a deeper look into the database and the directories of SentiTomo.</p>
<h3 id="database">Database</h3>
<p>By default SentiTomo is using a MySQL database, but theoretically it can be used with any other DBMS. We chose a MySQL database because for us it was the easiest and fastest way to set up. When the application is initially connected to the database it is creating all necessary tables and foreign keys automatically. In the following the different CREATE statements of the tables are listed.</p>
<p><strong>TW_Tweets</strong> holds all raw information of the tweets.</p>
<pre class="prettyprint source"><code>CREATE TABLE `TW_Tweet` (
`id` varchar(255) NOT NULL,
`keywordType` varchar(255) DEFAULT NULL,
`keyword` varchar(255) DEFAULT NULL,
`created` datetime DEFAULT NULL,
`createdWeek` int(11) DEFAULT NULL,
`toUser` varchar(255) DEFAULT NULL,
`language` varchar(255) DEFAULT NULL,
`source` varchar(255) DEFAULT NULL,
`message` varchar(255) DEFAULT NULL,
`hashtags` varchar(255) DEFAULT NULL,
`messagePrep` varchar(255) DEFAULT NULL,
`latitude` varchar(255) DEFAULT NULL,
`longitude` varchar(255) DEFAULT NULL,
`retweetCount` int(11) DEFAULT NULL,
`favorited` tinyint(1) DEFAULT NULL,
`favoriteCount` int(11) DEFAULT NULL,
`isRetweet` tinyint(1) DEFAULT NULL,
`retweeted` int(11) DEFAULT NULL,
`createdAt` datetime NOT NULL,
`updatedAt` datetime NOT NULL,
`TWUserId` varchar(255) DEFAULT NULL,
PRIMARY KEY (`id`),
KEY `TWUserId` (`TWUserId`),
CONSTRAINT `TW_Tweet_ibfk_1` FOREIGN KEY (`TWUserId`) REFERENCES `TW_User` (`id`) ON DELETE SET NULL ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8;</code></pre><p><strong>TW_Users</strong> contains information about the tweet authors.</p>
<pre class="prettyprint source"><code>CREATE TABLE `TW_User` (
`id` varchar(255) NOT NULL,
`username` varchar(255) DEFAULT NULL,
`screenname` varchar(255) DEFAULT NULL,
`createdAt` datetime NOT NULL,
`updatedAt` datetime NOT NULL,
`followercount` bigint(20) DEFAULT NULL,
PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;</code></pre><p><strong>TW_Sentiment</strong> contains information about the sentiments of different tweets.</p>
<pre class="prettyprint source"><code>CREATE TABLE `TW_Sentiment` (
`id` varchar(255) NOT NULL,
`sarcastic` double DEFAULT NULL COMMENT 'Sarcasm probability',
`sentiment` varchar(255) DEFAULT NULL COMMENT 'Final sentiment result',
`emojiSentiment` double DEFAULT NULL COMMENT 'sentiment of emojis in the message',
`emojiDesc` varchar(255) DEFAULT NULL COMMENT 'emojis in the message',
`rEnsemble` varchar(255) DEFAULT NULL COMMENT 'Result from R_algos',
`pythonEnsemble` varchar(255) DEFAULT NULL COMMENT 'Result from Python_algos',
`createdAt` datetime NOT NULL,
`updatedAt` datetime NOT NULL,
PRIMARY KEY (`id`),
CONSTRAINT `TW_Sentiment_ibfk_1` FOREIGN KEY (`id`) REFERENCES `TW_Tweet` (`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8;</code></pre><p><strong>TW_Topic</strong> contains information about the topics of different tweets.</p>
<pre class="prettyprint source"><code>CREATE TABLE `TW_Topic` (
`id` varchar(255) NOT NULL,
`topicId` int(11) DEFAULT NULL,
`topicContent` varchar(255) DEFAULT NULL,
`topicHeadline` varchar(255) DEFAULT NULL,
`probability` double DEFAULT NULL,
`createdAt` datetime NOT NULL,
`updatedAt` datetime NOT NULL,
PRIMARY KEY (`id`),
CONSTRAINT `TW_Topic_ibfk_1` FOREIGN KEY (`id`) REFERENCES `TW_Tweet` (`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8;</code></pre><p><strong>FB_Profile</strong> contains information about different Facebook profiles.</p>
<pre class="prettyprint source"><code>CREATE TABLE `FB_Profile` (
`id` varchar(255) NOT NULL,
`keyword` varchar(255) DEFAULT NULL,
`name` varchar(255) DEFAULT NULL,
`category` varchar(255) DEFAULT NULL,
`likes` int(11) DEFAULT NULL,
`type` varchar(255) DEFAULT NULL,
`createdAt` datetime NOT NULL,
`updatedAt` datetime NOT NULL,
PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;</code></pre><p><strong>FB_Post</strong> contains information about posts on Facebook.</p>
<pre class="prettyprint source"><code> CREATE TABLE `FB_Post` (
`id` varchar(255) NOT NULL,
`message` varchar(255) DEFAULT NULL,
`lang` varchar(3) DEFAULT NULL,
`story` varchar(255) DEFAULT NULL,
`likes` int(11) DEFAULT NULL,
`link` varchar(255) DEFAULT NULL,
`created` datetime DEFAULT NULL,
`createdAt` datetime NOT NULL,
`updatedAt` datetime NOT NULL,
`FBProfileId` varchar(255) DEFAULT NULL,
PRIMARY KEY (`id`),
KEY `FBProfileId` (`FBProfileId`),
CONSTRAINT `FB_Post_ibfk_1` FOREIGN KEY (`FBProfileId`) REFERENCES `FB_Profile` (`id`) ON DELETE SET NULL ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8;</code></pre><p><strong>FB_Comment</strong> contains information about comments on Facebook posts.</p>
<pre class="prettyprint source"><code>CREATE TABLE `FB_Comment` (
`id` varchar(255) NOT NULL,
`message` text,
`lang` varchar(3) DEFAULT NULL,
`createdAt` datetime NOT NULL,
`updatedAt` datetime NOT NULL,
`FBPostId` varchar(255) DEFAULT NULL,
PRIMARY KEY (`id`),
KEY `FBPostId` (`FBPostId`),
CONSTRAINT `FB_Comment_ibfk_1` FOREIGN KEY (`FBPostId`) REFERENCES `FB_Post` (`id`) ON DELETE SET NULL ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8;</code></pre><p><strong>FB_Sentiment</strong> contains information about the sentiment of Facebook posts.</p>
<pre class="prettyprint source"><code>CREATE TABLE `FB_Sentiment` (
`id` varchar(255) NOT NULL,
`sarcastic` double DEFAULT NULL,
`sentiment` varchar(255) DEFAULT NULL,
`emojiSentiment` double DEFAULT NULL,
`emojiDesc` varchar(255) DEFAULT NULL,
`rEnsemble` varchar(255) DEFAULT NULL,
`pythonEnsemble` varchar(255) DEFAULT NULL,
`createdAt` datetime NOT NULL,
`updatedAt` datetime NOT NULL,
PRIMARY KEY (`id`),
CONSTRAINT `FB_Sentiment_ibfk_1` FOREIGN KEY (`id`) REFERENCES `FB_Post` (`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8;</code></pre><p><strong>FB_Topic</strong> contains information about the topic of Facebook posts.</p>
<pre class="prettyprint source"><code>CREATE TABLE `FB_Topic` (
`id` varchar(255) NOT NULL,
`topicId` int(11) DEFAULT NULL,
`topicContent` varchar(255) DEFAULT NULL,
`topicHeadline` varchar(255) DEFAULT NULL,
`probability` double DEFAULT NULL,
`createdAt` datetime NOT NULL,
`updatedAt` datetime NOT NULL,
PRIMARY KEY (`id`),
CONSTRAINT `FB_Topic_ibfk_1` FOREIGN KEY (`id`) REFERENCES `FB_Post` (`id`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8;</code></pre><h3 id="server">Server</h3>
<p>All the backend server logic is placed inside the <code>server</code> directory. We won't cover every single file or directory here, but we want to introduce the most important ones which are the <code>ML</code> and <code>data</code> directories.</p>
<h4 id="ml">ML</h4>
<p>Inside the <code>ML</code> directory we placed all files which are related to the machine learning tasks, like sentiment analysis, topic detection and trend detection. It is divided in three subdirectories <code>Java</code>, <code>Python</code> and <code>R</code> to seperate the different programming languages. In the top level of <code>ML</code> you can find the wrapper files for incorporating the different programming languages with Javascript, <code>ml_wrapper.js</code> and <code>preprocess.js</code>. To let the different programming files work together we use Node's opportunity to spawn child processes and capture the output of these. To do so, we wrote a small file for calling the foreign code in a more convenient way, than directly spawning the child processes in the <code>ml_wrapper.js</code>. Those methods can be found in <code>/server/util/foreignCode.js</code>.
With that procedure we can spawn the machine learning tasks asynchronously to the main process, which leads to the fact that the main thread is not blocked or influenced by executing foreign code. In the following we want to explain how the integration works in detail.</p>
<h5 id="preface-important-notice-">Preface (Important Notice)</h5>
<p>It is not possible to pass complex data types and structures from Javascript to R, Python or Java. It can either be a <strong>plain string</strong> or a <strong>JSON encoded string</strong> which then needs to be parsed by the executed file. The same applies for the output. If the foreign code wants to output an complex object it is the best practice to convert it to a JSON representation so that the Node.js proceess can easily work with it. </p>
<p><strong>Possible packages and modules to use with JSON</strong></p>
<ul>
<li><strong>R</strong> with <a href="https://cran.r-project.org/web/packages/RJSONIO/index.html">RJSONIO</a></li>
<li><strong>Pyhton</strong> with <a href="https://docs.python.org/2/library/json.html">JSON Module</a></li>
<li><strong>Java</strong> with <a href="https://github.com/stleary/JSON-java">org.json library</a></li>
</ul>
<p><strong>Paths</strong></p>
<p>When foreign codes need access to some other files inside a directory it is mandatory to know that all files are executed in the scope of <code>./server/</code>. For example if a Python file needs to load a model from the Python directory it has to do it with the relative path <code>./ML/Python/filename.bin</code>.</p>
<p><strong>Examples</strong></p>
<p>All examples in JavaScript are written with ES6. To get a better understanding for the functions that <code>ml_wrapper.js</code> is using  have a look at <code>/server/util/foreignCode.js</code>.</p>
<p><strong>h2o</strong></p>
<p>SentiTomo is using <a href="https://www.h2o.ai/h2o/">h2o</a> to execute some machine learning tasks for sentiment analysis. To do so it spawns a Java child process which is setting up a h2o server on port 54321. This second server is then used to execute some algorithms on it. It is gracefully shutdown when you terminate the SentiTomo process.</p>
<p><em>Important</em>: </p>
<p>The R package version and the Java h20 server verison have to exactly match, if they do not match the sentiment detection will not work. We use the h2o version <strong>3.10.5.3</strong>. </p>
<p>If it is needed to have a look on the h2o server front end just visit <a href="localhost:54321">localhost:54321</a>.</p>
<p><strong>Integrated but not used files</strong></p>
<p>Inside the <code>./ML/R/topic</code> directory we have files which are integrated into <code>ml_wrapper.js</code> but  are not executed inside the server. We left it there to show a way to integrate topic detection in R to the server.</p>
<h5 id="r">R</h5>
<p>For integrating R with the server we were at first using a package called <a href="https://github.com/joshkatz/r-script">r-script</a> package. It ships with a handy R function called <code>needs()</code>. This is basically a combination of <code>install()</code> and <code>require()</code>. It ensures that the different packages which are required by our scripts are installed and loaded in the correct way. Therefore every R file has to use <code>needs()</code> instead of <code>ìnstall.package(&quot;packageName&quot;)</code> and <code>require(&quot;package&quot;)/load(&quot;package&quot;)</code>. Also it is recommended to place all functions at the top of the R files.
At the end of our project we faced some problems with this package so we decided to write our own implementation of calling R files, as mentioned in the introduction of <code>ML</code>. We followed the same approach as the <code>r-script</code> package did and included the <code>needs.R</code> file but simplified the process a little bit, so it could work with our application.
To provide data to the R process and retrieve it from it we can execute the R file from Javascript with the following command: </p>
<p><em>In JavaScript</em></p>
<pre class="prettyprint source"><code>import { RShell } from './util/foreignCode'

RShell(&quot;example/test.R&quot;)
  .data([tweet.message])
  .call(function(err, d) {
    if (err) throw err;
    console.log(d);
  });</code></pre><p>One thing to mention is that the implementation of the <code>RShell</code> class reads the console output from the R files. So if a file wants to a pass a value back to the JavaScript, for example the output of a classification task it <strong>SHOULD NOT ASSIGN IT TO VARIABLE</strong> just print it the console. The best way to do it is to write:</p>
<pre class="prettyprint source"><code>cat(yourVariable)</code></pre><p>With <code>cat</code> it is possible to remove the <code>[X]</code> identifier in front of the output. If you want to print out a named variable the best approach is to use </p>
<pre class="prettyprint source"><code>cat(unname(yourVariable))</code></pre><p><em>In R</em></p>
<pre class="prettyprint source"><code>source(needs.R)
needs(dplyr) # require every library so
args = commandArgs(trailingOnly=TRUE) # read command line

# Here comes all your function
# function 1
# function 2
# *****

# assign the retrieved value to a local one, this comes from the Javascript code
# It was passed like this {message: tweet.message}. It has the same name, 'message'.
out &lt;- args[1] # first command line argument
out &lt;- gsub(&quot;ut&quot;,&quot;ot&quot;,out) # do something with it
out # last line of the script should always print the value which you want to return to the server</code></pre><p><strong>Example for converting JSON to data.frame in R</strong></p>
<p>See this <a href="https://stackoverflow.com/a/16948174">great answer onStackoverflow</a></p>
<p><em>In JavaScript</em></p>
<pre class="prettyprint source"><code>import { RShell } from './util/foreignCode'


const message = {message: &quot;[{&quot;name&quot;:&quot;Doe, John&quot;,&quot;group&quot;:&quot;Red&quot;,&quot;age (y)&quot;:24,&quot;height (cm)&quot;:182,&quot;wieght (kg)&quot;:74.8,&quot;score&quot;:null},
    {&quot;name&quot;:&quot;Doe, Jane&quot;,&quot;group&quot;:&quot;Green&quot;,&quot;age (y)&quot;:30,&quot;height (cm)&quot;:170,&quot;wieght (kg)&quot;:70.1,&quot;score&quot;:500},
    {&quot;name&quot;:&quot;Smith, Joan&quot;,&quot;group&quot;:&quot;Yellow&quot;,&quot;age (y)&quot;:41,&quot;height (cm)&quot;:169,&quot;wieght (kg)&quot;:60,&quot;score&quot;:null},
    {&quot;name&quot;:&quot;Brown, Sam&quot;,&quot;group&quot;:&quot;Green&quot;,&quot;age (y)&quot;:22,&quot;height (cm)&quot;:183,&quot;wieght (kg)&quot;:75,&quot;score&quot;:865},
    {&quot;name&quot;:&quot;Jones, Larry&quot;,&quot;group&quot;:&quot;Green&quot;,&quot;age (y)&quot;:31,&quot;height (cm)&quot;:178,&quot;wieght (kg)&quot;:83.9,&quot;score&quot;:221},
    {&quot;name&quot;:&quot;Murray, Seth&quot;,&quot;group&quot;:&quot;Red&quot;,&quot;age (y)&quot;:35,&quot;height (cm)&quot;:172,&quot;wieght (kg)&quot;:76.2,&quot;score&quot;:413},
    {&quot;name&quot;:&quot;Doe, Jane&quot;,&quot;group&quot;:&quot;Yellow&quot;,&quot;age (y)&quot;:22,&quot;height (cm)&quot;:164,&quot;wieght (kg)&quot;:68,&quot;score&quot;:902}]'&quot;}

RShell(&quot;example/test.R&quot;)
  .data([JSON.stringifiy(message)])
  .call(function(err, d) {
    if (err) throw err;
    console.log(d);
  });</code></pre><p><em>In R</em></p>
<pre class="prettyprint source"><code>needs(RJSONIO)   
args = commandArgs(trailingOnly=TRUE) # read command line
json &lt;- fromJSON(args[1])   # comes from Javascript {message: variable}
json &lt;- lapply(json, function(x) {
  x[sapply(x, is.null)] &lt;- NA
  unlist(x)
})
do.call(&quot;rbind&quot;, json)</code></pre><p>Outcome is a data.frame</p>
<pre class="prettyprint source"><code>     name           group    age (y) height (cm) wieght (kg) score
[1,] &quot;Doe, John&quot;    &quot;Red&quot;    &quot;24&quot;    &quot;182&quot;       &quot;74.8&quot;      NA   
[2,] &quot;Doe, Jane&quot;    &quot;Green&quot;  &quot;30&quot;    &quot;170&quot;       &quot;70.1&quot;      &quot;500&quot;
[3,] &quot;Smith, Joan&quot;  &quot;Yellow&quot; &quot;41&quot;    &quot;169&quot;       &quot;60&quot;        NA   
[4,] &quot;Brown, Sam&quot;   &quot;Green&quot;  &quot;22&quot;    &quot;183&quot;       &quot;75&quot;        &quot;865&quot;
[5,] &quot;Jones, Larry&quot; &quot;Green&quot;  &quot;31&quot;    &quot;178&quot;       &quot;83.9&quot;      &quot;221&quot;
[6,] &quot;Murray, Seth&quot; &quot;Red&quot;    &quot;35&quot;    &quot;172&quot;       &quot;76.2&quot;      &quot;413&quot;
[7,] &quot;Doe, Jane&quot;    &quot;Yellow&quot; &quot;22&quot;    &quot;164&quot;       &quot;68&quot;        &quot;902&quot;</code></pre><h5 id="python">Python</h5>
<p>For Python we initially used a package called <a href="https://github.com/extrabacon/python-shell">python-shell</a> to execute single Python files. But as our Python scripts need both, Python 2 and 3, we had some issues to make this package work with version 3. So in the end we decided to develop implementation and add it to the <code>/server/util/foreignCode.js</code> module. With our code we were able to set the Python version manually. Additionally the files are able to retrieve command line arguments which makes the communication between JS and Python possible. This is again based on reading the console prints of the Python file. One advice is, to make sure to not heavily use the console for prints, because the main JavaScript process only needs to know the final result of the Python script.</p>
<p>A small example with passing JSON forth and back: </p>
<p><em>In Javascript</em></p>
<pre class="prettyprint source"><code>import { PythonShell } from './util/foreignCode';

/**
 * @function test
 * @param  {String} message  Message to the file
 * @param  {Function} callback Function to handle the sentiment result
 * @description Test function to show the Python procedure
 * @return {String} Result of the 
 */
var test = function(message, callback) {
    PythonShell('./ML/Python/test.p').data([message]).call(result => {
        callback(result.trim());
    })
}

test('{&quot;message&quot;: &quot;This is my message&quot;}', result => {
    console.log(result);
});</code></pre><p><em>In Python</em></p>
<pre class="prettyprint source"><code>import sys, json

# simple JSON echo script
for line in sys.argv[1:]:
  print json.dumps(json.loads(line))


#Plain decode JSON
json.loads(argv[1])</code></pre><p><strong>Output in the Javascript</strong></p>
<pre class="prettyprint source"><code>{&quot;message&quot;: &quot;This is my message&quot;}</code></pre><h5 id="java">Java</h5>
<p>For Java we followed the same approach and added the spawning process of the files to our existing file for spawning foreign code. It is the exact same process like with Python, the only thing which is different that you have to execute the .jar instead of the Python file.</p>
<p><em>In Javascript</em></p>
<pre class="prettyprint source"><code>import {JavaShell} from './wrapper/codeWrapper';';

 /**
     * @function test
     * @param  {String} message  Message to the file
     * @param  {Function} callback Function to handle the sentiment result
     * @description Test function to show the Java procedure
     * @return {String} Result of the 
     */
    var test = function(filename, callback) {
        JavaShell(&quot;./ML/Java/test.jar&quot;).data([message]).call(result => {
            callback(result.trimt());
        })
    }

test(&quot;Hello world&quot;, result => {
    console.log(result)
});</code></pre><p><em>In Java</em></p>
<pre class="prettyprint source"><code>public class HelloWorld {

    public static void main(String[] args) {
        // Prints the command line argument to the terminal window.
        System.out.println(args[0]);
    }

}</code></pre><p>The <code>JavShell</code> is only used for executing the <code>h20.jar</code>, to set up the h20 server. We also put a Naive Bayes based sentiment analysis Java implementation into the server but it is not actively used during the exectuion. It should only serve as a reference for invoking a <code>.jar</code> machine learning file with SentiTomo. It can be found in <code>sentitomo/ML/Java/sentiment/</code>.</p>
<h4 id="data">data</h4>
<p>Inside the <code>data</code> directory the connection to the database and the <code>GraphQL</code> schema defininiton are expressed. 
For connecting to the database we use a package called <a href="http://docs.sequelizejs.com/">Sequlize.js</a>. It offers the opportunity to work on a higher level way with databases. Sequlize provides methods which just define the database schema and the resulting SQL queries for inserting, updating and deleting records are build dynamically and are fully handled by the package itself. It supports PostgreSQL, MySQL, SQLite and MSSQL dialects. It was also used in the resolver function for the GraphQL API (<code>sentitomo/server/data/resolvers.js</code>).</p>
<p>Another main part of the <code>data</code> directory is the set up of GraphQL which is written in <code>sentitomo/server/data/resolvers.js</code>. It handles all the requests to the API whose schema is defined in <code>sentitomo/server/data/schema.js</code>. For this part we used a Node.js package called <a href="https://github.com/apollographql/apollo-server">apollo-server</a>. It is a great, easy to use open-source implementation of GraphQL on the server-side.
In the following we want to provide a sample request to the API and depict what the response looks like:</p>
<p>Request sent to <a href="">localhost:8080/graphql</a>:</p>
<pre class="prettyprint source"><code>{
  tweet(id: &quot;881026061806571520&quot;){
    id
    message
    sentiment {
      id
      sentiment
    }
    author{
      id
      screenname
      username
    }
  }
}</code></pre><p>Response:</p>
<pre class="prettyprint source"><code>{
  &quot;data&quot;: {
    &quot;tweet&quot;: {
      &quot;id&quot;: &quot;881026061806571520&quot;,
      &quot;message&quot;: &quot;New2Trip: Rheumatoid arthritis-specific cardiovascular risk scores are not superior to general risk scores: va&lt;U+2026> https://t.co/KRZDi95ctL&quot;,
      &quot;sentiment&quot;: {
        &quot;id&quot;: &quot;881026061806571520&quot;,
        &quot;sentiment&quot;: &quot;negative&quot;
      },
      &quot;author&quot;: {
        &quot;id&quot;: &quot;2199494760&quot;,
        &quot;screenname&quot;: &quot;TripPrimaryCare&quot;,
        &quot;username&quot;: &quot;Trip Primary Care&quot;
      }
    }
  }
}</code></pre><p><strong>What is happening ?</strong></p>
<p>At first the request from the client is piped through the resolvers of <code>resolvers.js</code> and the <code>tweet(_,args)</code> method is invoked because the request accessed the <code>tweet</code> endpoint. The <code>args</code> object contains all arguments  which are provided to the endpoint. In this example only the <code>id</code> value of the tweet. To get the result from the database we use the database model object of sequlize.js, called <code>Tweet</code>, which is defined in the <code>connectors.js</code> file. It returns the tweet 'where tweet.id = args.id'. In the end a new data object is constructed which contains all the information that were requested.</p>
<p><code>resolvers.js</code> (truncated)</p>
<pre class="prettyprint source"><code>import {
    TweetAuthor,
    Tweet,
    TweetSentiment,
    TweetTopic,
    FacebookProfile,
    FacebookPost,
    FacebookComment
} from './connectors';
import moment from 'moment';
import GraphQLMoment from './scalar/GraphQLMoment';

const resolvers = {
    Date: GraphQLMoment,
    Query: {
        ...,
        tweet(_, args) {
            return Tweet.find({
                where: args
            });
        },
        ...
    },
    Author: {
        tweets(author) {
            return author.getTweets();
        },
    },
    Tweet: {
        author(tweet) {
            return tweet.getTW_User();
        },
        sentiment(tweet) {
            return tweet.getTW_SENTIMENT();
        },
        topic(tweet) {
            return tweet.getTW_TOPIC();
        }
    },
};</code></pre><p><code>schema.js</code> (Provides the different API queries and the available fields)</p>
<pre class="prettyprint source"><code>/**
 * @constant typeDefinitions
 * @type {String}
 * @description Type definition schema for the GraphQL API. here all types, queries and mutations are specified which the API is offering
 */
const typeDefinitions = `

  scalar Date
  type Tweet {
    id: String
    keywordType: String
    keyword: String
    created: String
    createdWeek: Int
    toUser: String
    language: String
    source: String
    message: String
    messagePrep: String
    latitude: String
    longitude: String
    retweetCount: Int
    favorited: Boolean
    favoriteCount: Int
    isRetweet: Boolean
    retweeted: Int
    author: Author
    sentiment: Sentiment
    topic: Topic
  }

  type Author {
    id: String
    username: String
    screenname: String
    tweets: [Tweet]
  }

  type Sentiment {
    id: String
    sentiment: String
  }

  type Topic {
    id: String
    topic1Month: String
    topic1Month_C: String
    topic3Month: String
    topic3Month_C: String
    topicWhole: String
    topicWhole: String
  }

  type Query {
    tweet(id: String): Tweet
    sentiment(id: String): Sentiment
    topic(id: String): Topic
    author(username: String): Author
    tweets(limit: Int, offset: Int, startDate: Date, endDate: Date): [Tweet]
    count(startDate: Date, endDate: Date): Int
  }

  schema {
      query: Query
  }
';
export default [typeDefinitions];</code></pre><h3 id="client">Client</h3>
<p>SentiTomo comes pre-shipped with an own front-end implementation written with the React framework and build with the <a href="https://github.com/facebookincubator/create-react-app">create-react-app</a> configuration. This makes it possible to integrate the app into any static HTML site you want. </p>
<p>We created it to show a way of how to integrate a fully customizable front-end to our server. The fact that the React app is converted into a static <code>.js</code> file makes it very easy to integrate it into the express Node.js server. It is able to send a static HTML file down to the client if some specific URL is visited. We configured the server to serve the dashboard app to the client if the <code>/app/*</code> URL is visited. Furthermore we added a static endpoint for serving CSS, JS and web fonts which are used in the React app. </p>
<pre class="prettyprint source"><code>server.use('/static', express.static(path.join(__dirname + '/../client/build/static')));
server.use('/static', express.static(path.join(__dirname + '/../client/build/fonts')));</code></pre><pre class="prettyprint source"><code>server.get('/app/*', (req, res) => {
    res.sendFile(path.join(__dirname + '/../client/build/index.html'));
});</code></pre><p>With this set up it was possible to integrate the React dashboard app into the SentiTomo server.</p>
<p>To communicate with the server the dashboard uses websockets to open a bidrectional channel to the server.</p>
<pre class="prettyprint source"><code>import io from 'socket.io-client'
const socket = io(`http://localhost:8080`, { reconnectionDelay: 4000 });
export default socket;</code></pre><pre class="prettyprint source"><code> socket.on('connect', data => {
    NotificationManager.success('Connected to the server', 'Success', 3000);
})</code></pre><p>This channel is primarily used for initiating server methods like starting and stopping the topic and sentiment worker or initating the dynamic topic model building process. This is the most outstanding feature of having a integrated front-end, because third party solutions for displaying the data do not have such an communication channel.</p>
<p>When the application is started, the front-end is available at <a href="localhost:8080/app/">localhost:8080/app/</a>. It offers two different views right now:</p>
<ul>
<li><a href="localhost:8080/app/dashbaord">/dashboard</a> rudimentary dashboard</li>
<li><p><a href="localhost:8080/app/toolbox">/toolbox</a> different options to initate machine learning tasks dynamically </p>
<p>The static <code>app/dashboard</code> view can be used to view the results of topic and sentiment worker and the<code>app/toolbox/</code>view serves as an interface to initiate the dynamic topic model building process or controlling the workers functions. </p>
</li>
</ul>
<h4 id="static-view">Static view</h4>
<p>On the static view you can specify a time range and click the <code>View tweets</code> button. A request is made to the GraphQL API which retrieves the sentiments and topic results. After succesfully getting these results a message is sent to the server to detect trends based on the specified time range by using a poisson based model to predict topic trends. The outcome of this detection is then merged with the previous result from the API.
Now the combined results are displayed beneath the time selection box.</p>
<p><img src="https://raw.githubusercontent.com/BluePhoenix1908/AbbVie2017/master/FINAL/sentitomo/img/sentitomo_dashboard.png" alt="SentiTomo Dashboard"></p>
<p><em>Static dashboard view</em></p>
<p><img src="https://raw.githubusercontent.com/BluePhoenix1908/AbbVie2017/master/FINAL/sentitomo/img/sentitomo_dashboard_topic_senti.png" alt="SentiTomo Dashboard Topic and Sentiment"></p>
<p><em>Static dashboard topic and sentiment</em></p>
<p>The pie chart shows all the detected topics. The parts of the charts are  clickable and serving as a filter for the sentiment, timeline and trend detection values.</p>
<p><img src="https://raw.githubusercontent.com/BluePhoenix1908/AbbVie2017/master/FINAL/sentitomo/img/sentitomo_dashboard_trend.png" alt="SentiTomo Dashboard Trend"></p>
<p><em>Static dashboard trend based on topic</em></p>
<p>Additionally the raw tweets are displayed inside a table to get a better feeling for the results and be able to check for inconsistencies. </p>
<p><img src="https://raw.githubusercontent.com/BluePhoenix1908/AbbVie2017/master/FINAL/sentitomo/img/sentitomo_dashboard_tweets.png" alt="SentiTomo Dashboard Tweets"></p>
<p><em>Static dashboard tweets</em></p>
<h4 id="toolbox-view">Toolbox view</h4>
<p>The toolbox view in total offers two sub views:</p>
<ul>
<li>Topic and</li>
<li>Worker</li>
</ul>
<p>The 'Topic' view shares the same layout as the dashboard view. But instead of just viewing tweets by selecting a time range, with a click on the 'Detect Topics' button, a new clustering of the selected tweets is initated on the server. For building the topic detection model only the selected tweets are used. After the server has finished building the model and detecting the topics, it also applies the poisson trend detection to the fresh clustered messages. After both results are calculated the result is sent back to the client via the websocket connection and gets displayed. </p>
<p><img src="https://raw.githubusercontent.com/BluePhoenix1908/AbbVie2017/master/FINAL/sentitomo/img/sentitomo_toolbox.png" alt="SentiTomo Toolbox"></p>
<p><em>Toolbox</em></p>
<p>The worker tab can be used to control the sentiment and topic workers on the server. When the buttons are clicked a message is sent through the websocket connection to toggle the state of the worker functions. With this mechanism it is possible to either start or stop the detection of topics and sentiments.</p>
<p><img src="https://raw.githubusercontent.com/BluePhoenix1908/AbbVie2017/master/FINAL/sentitomo/img/sentitomo_toolbox_worker.png" alt="SentiTomo Toolbox"></p>
<p><em>Toolbox Worker</em></p>
<p>Most of the interactivity bewteen the client and server is managed with websocket connections. To demonstrate the common workflow we want to present some code snippets which are responsible for toggling the worker functions.</p>
<p>On the server side, listerners are waiting for specific message indicators and executes different functions based on the data which was sent. The snippet shows two listeners. One for sending the current worker status and one for starting and stopping them.</p>
<pre class="prettyprint source"><code>    ...
        /*
        * Client requests the current state of the worker threads
        */
        socket.on('client:getWorkers', () => {
            socket.emit('server:getWorkers', {
                topicWorker: global.topicWorker.running,
                sentimentWorker: global.sentimentWorker.running,
            });
        });

        /*
        * Client wants to either stop or start a specific worker thread
        */
        socket.on('client:toggleWorker', data => {
            switch (data.type) {
                case &quot;topic&quot;: global.topicWorker.running ? global.topicWorker.stop() : global.topicWorker.start(); break;
                case &quot;sentiment&quot;: global.sentimentWorker.running ? global.sentimentWorker.stop() : global.sentimentWorker.start(); break;
                default: break;
            }
        });
    ...</code></pre><p>On the client side we have nearly the same structure. At first we initalize a listener which waits for a message from the server. When a server message comes in, it contains information about the state of the worker functions and the state of the ToolBox component is set accordingly to indicate the state the workers on the front-end (red or green buttons). Here it is possible to send a message back to server by clicking on one of the two buttons. This click will execute the <code>toggleWorker()</code> function with the specific <code>worker</code> parameter set. When this message then reaches the server, the <code>client:toggleWorker listener</code> is called and toggles the state of the worker accordingly.</p>
<pre class="prettyprint source"><code>...

    componentDidMount() {
        socket.on('server:getWorkers', data => {
            this.setState({
                topicWorker: data.topicWorker,
                sentimentWorker: data.sentimentWorker
            })
        })
        setInterval(() => this.getWorkerState(), 5000)
    }

    /**
     * @function getWorkerState
     * @description Sends a message to the server, to get the status of the topic and sentiment workers
     * @memberof WorkerToolBox
     * @return {void}
     */
    getWorkerState = () => {
        socket.emit('client:getWorkers', null)
    }

    /**
    * @function toggleWorker
    * @param {String} worker Specifies which worker function to toggle
    * @description Sends a message to the server and toggles the state of the specified worker, either topic or sentiment
    * @memberof WorkerToolBox
    * @return {void}
    */
    toggleWorker = (worker) => {
        socket.emit('client:toggleWorker', {
            type: worker
        })
    }

...</code></pre><p>The whole procedure is also shown as a <a href="#sequence-diagrams">sequence diagram</a>.</p>
<h2 id="known-issues">Known Issues</h2>
<p><img src="https://img.shields.io/badge/issues-3-yellow.svg" alt="Issue count"></p>
<p>There are some issues inside the server application we could not fix till the end of the project. They are primarily related to the connection to the database. It seems that if the database is under heavily load it rejects requests to it and therefore our functions time out. Because this is a matter of testing out different configurations and we did not had a fully configurable MySQL server hat we could not figure out how to resolve this issues.  </p>
<table>
<thead>
<tr>
<th>Id</th>
<th>Issue</th>
<th>Potential solution</th>
<th>Status</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>Timeouts to database when requesting a lot object from the GraphQL</td>
<td>Modify sequelize.js config or DB server config</td>
<td><img src="https://img.shields.io/badge/solved-no-red.svg" alt="Solved"></td>
</tr>
<tr>
<td>2</td>
<td>Timeouts when the sentiment worker is running for a long time</td>
<td>Modify sequelize.js config or DB server config</td>
<td><img src="https://img.shields.io/badge/solved-no-red.svg" alt="Solved"></td>
</tr>
<tr>
<td>3</td>
<td>Node server crashes when loading a lot of tweets from the database</td>
<td>Caching results or inetgrate better API resolvers</td>
<td><img src="https://img.shields.io/badge/solved-no-red.svg" alt="Solved"></td>
</tr>
</tbody>
</table>
<h2 id="sequence-diagrams">Sequence Diagrams</h2>
<p><strong>Server start</strong>:</p>
<p><img src="https://raw.githubusercontent.com/BluePhoenix1908/AbbVie2017/master/FINAL/sentitomo/sequence_diagrams/img/server_startup_sequence.png" alt="Server Start Sequence Diagram"></p>
<p><strong>Twitter Crawl</strong>:</p>
<p><img src="https://raw.githubusercontent.com/BluePhoenix1908/AbbVie2017/master/FINAL/sentitomo/sequence_diagrams/img/twitter_crawl_sequence.png" alt="Twitter Crawl Sequence Diagram"></p>
<p><strong>Topic Detection</strong>:</p>
<p><img src="https://raw.githubusercontent.com/BluePhoenix1908/AbbVie2017/master/FINAL/sentitomo/sequence_diagrams/img/topic_detection_worker_sequence.png" alt="Topic Detection Worker Sequence Diagram"></p>
<p><strong>Sentiment Detection</strong>:</p>
<p><img src="https://raw.githubusercontent.com/BluePhoenix1908/AbbVie2017/master/FINAL/sentitomo/sequence_diagrams/img/sentiment_detection_worker_sequence.png" alt="Sentiment Detection Worker Sequence Diagram"></p>
<p><strong>Toggle worker functions</strong>:</p>
<p><img src="https://raw.githubusercontent.com/BluePhoenix1908/AbbVie2017/master/FINAL/sentitomo/sequence_diagrams/img/toggle_worker_sequence.png" alt="Toggle Worker Sequence Diagram"></p>
<h2 id="conclusion">Conclusion</h2>
<p>With this application we wanted to show one way of using our findings and algorithms in a production-like environment. We showed how it is possible to built a server application which is capable of integrating different programming languages and use them for machine learning in an efficient way. With Node.js it is an ease to set up an highly scalable server which can handle asynchronous executions of foreign code very well. The ability to spawn child processes offers a reliable way to communicate with those foreign code files. GraphQL makes it it possible to set up a very modern and reliable API which any front-end can use to retrieve the result, from  the SentiTomo database. Due to the implementation of it, possible changes to the database management system will very like not affect the API endpoints which lead to the fact that changes to the client side has not be updated accordingly. This drastically reduces maintenance costs.</p>
<p>On the client side we implemented React, which makes the appearence highly dynamical and the codebase is well structured. With the help of different packages it was possible to built a easy to use and good looking user interface.</p>
<p>We hope that we could show you one possible way of how to build a good solution for monitoring topics and trends in social media today.</p>
<h2 id="questions">Questions</h2>
<p>If you any question arise while looking trough the docs, the code or while testing the application, please do not hesitate and contact us. </p>
<p><strong>Note</strong></p>
<p>We did not include application tests inside, because this is more like a showcase how the integration of such an application can be done rather than providing a fully working and mature application.</p></article>
    </section>






</div>

<br class="clear">

<footer>
    Generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.3</a> on Sun Sep 03 2017 15:24:41 GMT+0200 (CEST) using the Minami theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>