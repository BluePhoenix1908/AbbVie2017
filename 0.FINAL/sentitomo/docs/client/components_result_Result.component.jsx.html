<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>components/result/Result.component.jsx - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <li class="nav-link nav-home-link"><a href="index.html">Home</a></li><li class="nav-heading">Classes</li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="Applayout.html">Applayout</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Applayout.html#.componentDidMount">componentDidMount</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="CustomSentimentToolTip.html">CustomSentimentToolTip</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="CustomTopicToolTip.html">CustomTopicToolTip</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="Dashboard.html">Dashboard</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Dashboard.html#.handleDayClick">handleDayClick</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="Icon.html">Icon</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="Result.html">Result</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Result.html#.aggregateDate">aggregateDate</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Result.html#.aggregateSentiment">aggregateSentiment</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Result.html#.aggregateTopics">aggregateTopics</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Result.html#.formatDate">formatDate</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Result.html#.onSentimentCellClick">onSentimentCellClick</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Result.html#.onTopicCellClick">onTopicCellClick</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Result.html#.onTopicLegendClick">onTopicLegendClick</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Result.html#.resetSelection">resetSelection</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="SideNavigation.html">SideNavigation</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="ToolBox.html">ToolBox</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="TopicToolBox.html">TopicToolBox</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="TopicToolBox.html#.handleDayClick">handleDayClick</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="TopicToolBox.html#.handleResetClick">handleResetClick</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="TopicToolBox.html#.sendMessage">sendMessage</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="WorkerToolBox.html">WorkerToolBox</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="WorkerToolBox.html#.getWorkerState">getWorkerState</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="WorkerToolBox.html#.toggleWorker">toggleWorker</a></span></li><li class="nav-heading"><a href="global.html">Globals</a></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#loadTweets">loadTweets</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#renderSentimentLegend">renderSentimentLegend</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#renderTopicLegend">renderTopicLegend</a></span></li>
</nav>

<div id="main">
    
    <h1 class="page-title">components/result/Result.component.jsx</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import React, { Component } from 'react';
import PropTypes from 'prop-types';
import { Card, Grid, Label, List, Segment, Table } from 'semantic-ui-react'
import { PieChart, Pie, Cell, Legend, Tooltip, XAxis, YAxis, CartesianGrid, Line, ResponsiveContainer, ComposedChart } from 'recharts';
import randomColor from 'randomcolor';
import dl from 'datalib';
import moment from 'moment';


/**
 * @constant renderTopicLegend
 * @param {Object} props Data about the different entries in the chart
 * @type {function}
 * @description Renders a custom topic pie chart legend
 */
const renderTopicLegend = (props) => {
    const { payload } = props;
    return (
        &lt;List divided selection>
            {
                payload.map((entry, index) => {
                    return (&lt;List.Item key={`item-${index}`} onClick={() => props.onClick(entry.payload.payload)}>
                        &lt;Label style={{ background: entry.color }} horizontal />
                        {entry.payload.payload.topic ? entry.payload.payload.topic : "Null"}
                    &lt;/List.Item>)

                })
            }
        &lt;/List>
    );
}

/**
 * @class CustomTopicToolTip
 * @extends {React.Component}
 * @description Class for displaying customized tooltip on the topic pie chart
 */
class CustomTopicToolTip extends Component {
    render() {
        const { active } = this.props;

        if (active) {
            const { payload, label } = this.props;
            return (
                &lt;Card className="tooltip" style={{ background: "#fff !important", color: "#000 !important" }}>
                    &lt;Card.Content>
                        &lt;p className="label">{`Topic-ID : ${payload[0].payload.topicId}`}&lt;/p>
                        &lt;p className="intro">{'Conent:' + payload[0].payload.topic}&lt;/p>
                    &lt;/Card.Content>
                &lt;/Card>
            );
        }

        return null;
    }
}

/**
 * @constant renderSentimentLegend
 * @param {Object} props Data about the different entries in the chart
 * @type {function}
 * @description Renders a custom sentiment pie chart legend
 */
const renderSentimentLegend = (props) => {
    const { payload } = props;
    return (
        &lt;List divided selection>
            {
                payload.map((entry, index) => {
                    return (&lt;List.Item key={`item-${index}`}>
                        &lt;Label style={{ background: entry.color }} horizontal />
                        {entry.payload.payload.sentiment}
                    &lt;/List.Item>)

                })
            }
        &lt;/List>
    );
}

/**
 * @class CustomSentimentToolTip
 * @extends {React.Component}
 * @description Class for displaying customized tooltip on the sentiment pie chart
 */
class CustomSentimentToolTip extends Component {
    render() {
        const { active } = this.props;

        if (active) {
            const { payload, label } = this.props;
            return (
                &lt;Card className="tooltip">
                    &lt;Card.Content>
                        &lt;p className="label">{`Sentiment : ${payload[0].payload.sentiment}`}&lt;/p>
                    &lt;/Card.Content>
                &lt;/Card>
            );
        }

        return null;
    }
}

/**
 * @class Result
 * @extends {React.Component}
 * @description Class for displaying the result of a dynamic topic detection
 */
class Result extends Component {

    state = { selectedTopic: null, selectedSentiment: null }

    /**
     * @function aggregateTopics
     * @param  {Array} data Array of topic detection data
     * @description Aggregates the data of the array by topics
     * @memberof Result
     * @return {Array} Aggregated topic array
     */
    aggregateTopics = (data) => {
        var copy = JSON.parse(JSON.stringify(data)); // We need to deep copy the array, as we do not want to hold reference to the original array here
        var myData = dl.read(copy, { type: 'json', parse: 'auto' });
        return (dl.groupby(['topicId', 'topic']).count().execute(myData));
    }

    /**
     * @function aggregateSentiment
     * @param  {Array} data Array of topic detection data
     * @description Aggregates the data of the array by sentiment
     * @memberof Result
     * @return {Array} Aggregated sentiment array
     */
    aggregateSentiment = (data) => {
        var copy = JSON.parse(JSON.stringify(data)); // We need to deep copy the array, as we do not want to hold reference to the original array here
        var myData = dl.read(copy, { type: 'json', parse: 'auto' });
        return (dl.groupby(['sentiment']).count().execute(myData));
    }

    /**
     * @function aggregateDate
     * @param  {Array} data Array of topic detection data
     * @description Aggregates the data of the array by date (based on days)
     * @memberof Result
     * @return {Array} Aggregated date array
     */
    aggregateDate = (data) => {

        var copy = JSON.parse(JSON.stringify(data)); // We need to deep copy the array, as we do not want to hold reference to the original array here
        copy.forEach((obj, index, array) => {
            array[index].created = new Date(array[index].created).setHours(0, 0, 0, 0)
        })

        var myData = dl.read(copy, { type: 'json', parse: 'auto' });
        return (dl.groupby(['created'])
            .summarize({ 'created': 'count' })
            .execute(myData));
    }

    /**
     * @function onTopicCellClick
     * @param  {Object} entry Entry of the graph which was clicked
     * @param  {Integer} index Index of the selected entry inside the entries array
     * @description Set the this.state.selectedTopic to entry
     * @memberof Result
     * @return {void}
     */
    onTopicCellClick = (entry, index) => {
        this.setState({
            selectedTopic: entry,
            selectedSentiment: null // reset the sentiment selection
        })
    }

    /**
     * @function onTopicLegendClick
     * @param  {Object} data Data of the legend, same as an entry of the graph
     * @description Set the this.state.selectedTopic to data
     * @memberof Result
     * @return {void}
     */
    onTopicLegendClick = (data) => {
        this.setState({
            selectedTopic: data,
            selectedSentiment: null // reset the sentiment selection
        });
    }

    /**
     * @function onSentimentCellClick
     * @param  {Object} entry Entry of the graph which was clicked
     * @param  {Integer} index Index of the selected entry inside the entries array
     * @description Set the this.state.selectedSentiment to entry
     * @memberof Result
     * @return {void}
     */
    onSentimentCellClick = (entry, index) => {
        this.setState({
            selectedSentiment: entry
        })
    }

    /**
   * @function resetSelection
   * @description Sets this.state.selectedTopics and this.state.selectedSentiment to null
   * @memberof Result
   * @return {void}
   */
    resetSelection = () => {
        this.setState({
            selectedTopic: null,
            selectedSentiment: null,
        })
    }

    /**
     * @function formatDate
     * @param  {Object} data Date from the x-axis ticks
     * @description Formats the date of a data object in a readable format using moment.js
     * @memberof Result
     * @return {String} Date string encoded on "DD-MM-YYYY"
     */
    formatDate = (data) => {
        return moment(new Date(data)).format("DD-MM-YYYY");
    }

    render() {
        const { data, withLDA } = this.props;
        const { selectedTopic, selectedSentiment } = this.state;



        if (data) {

            console.log(data);
            const result = data.tweets;
            const trend = data.trend;

            var aggregatedTopics = null;
            var aggregateSentiment = null;
            var aggregateDate = null;
            var selectedTrendGraph = null;
            aggregatedTopics = this.aggregateTopics(result.slice()).sort((a, b) => { return a.count - b.count });

            var colors = randomColor({
                count: aggregatedTopics.length,
                hue: 'random', luminosity: "random", seed: 123412
            });


            if (selectedTopic) {

                if (selectedSentiment) {
                    aggregateSentiment = this.aggregateSentiment(result.slice().filter(element => {
                        return element.topicId == selectedTopic.topicId &amp;&amp; element.sentiment == selectedSentiment.sentiment
                    }));

                    aggregateDate = this.aggregateDate(result.slice().filter(element => {
                        return element.topicId == selectedTopic.topicId &amp;&amp; element.sentiment == selectedSentiment.sentiment
                    }))
                } else {

                    var trendDetail = trend.find(element => { return element.topicId == this.state.selectedTopic.topicId });
                    var selectedTrendGraph = trendDetail ? trendDetail.trendGraph : null;  // If the selected topic has an trend graph, return it, if not set the value to null

                    aggregateSentiment = this.aggregateSentiment(result.slice().filter(element => {
                        return element.topicId == selectedTopic.topicId
                    }));

                    aggregateDate = this.aggregateDate(result.slice().filter(element => {
                        return element.topicId == selectedTopic.topicId
                    }))
                }
            }

            return (
                &lt;div className="result-pane">

                    &lt;Grid stackable columns={3}>
                        &lt;Grid.Row>
                            &lt;Grid.Column mobile={16} tablet={7} computer={7}>
                                &lt;Card fluid className="result">
                                    &lt;Card.Content header={"Aggregrated Topics"} />
                                    &lt;Card.Content className={'card-body'}>
                                        &lt;ResponsiveContainer height={500}>
                                            &lt;PieChart>
                                                &lt;Pie data={aggregatedTopics} dataKey="count" fill="#8884d8" label onClick={(entry, index) => this.onTopicCellClick(entry, index)}>
                                                    {
                                                        aggregatedTopics.map((entry, index) => (
                                                            &lt;Cell key={`cell-${index}`} fill={colors[index]} />
                                                        ))
                                                    }
                                                &lt;/Pie>
                                                &lt;Tooltip content={&lt;CustomTopicToolTip />} />

                                                &lt;Legend content={renderTopicLegend} style={{ maxHeight: "250px !important", overflow: "auto" }} onClick={this.onTopicLegendClick} />
                                            &lt;/PieChart>
                                        &lt;/ResponsiveContainer >
                                    &lt;/Card.Content>
                                &lt;/Card>
                            &lt;/Grid.Column>
                            &lt;Grid.Column mobile={16} tablet={7} computer={7}>
                                &lt;Card fluid className="result">
                                    &lt;Card.Content header={"Sentiments in topic"} />
                                    &lt;Card.Content className={'card-body'}>
                                        {this.state.selectedTopic &amp;&amp; aggregateSentiment.length > 0 ?
                                            &lt; ResponsiveContainer height={500}>
                                                &lt;PieChart>
                                                    &lt;Pie data={aggregateSentiment} dataKey="count" fill="#8884d8" label onClick={(entry, index) => this.onSentimentCellClick(entry, index)} >
                                                        {
                                                            aggregateSentiment.map((entry, index) => {
                                                                return (&lt;Cell key={`cell-${index}`} fill={entry.sentiment === 'negative' ? "#e74c3c" : entry.sentiment === 'positive' ? "#2ecc71" : "#f1c40f"} />)
                                                            })
                                                        }
                                                    &lt;/Pie>
                                                    &lt;Tooltip content={&lt;CustomSentimentToolTip />} />
                                                    &lt;Legend content={renderSentimentLegend} style={{ maxHeight: "250px !important", overflow: "auto" }} onClick={this.onLegendClick} />
                                                &lt;/PieChart>
                                            &lt;/ResponsiveContainer >
                                            : "No sentiment values in data"}
                                    &lt;/Card.Content>
                                &lt;/Card>
                            &lt;/Grid.Column>
                            &lt;Grid.Column mobile={16} tablet={2} computer={2}>
                                &lt;Segment raised style={{ position: "fixed", marginRight: "2em", zIndex: "100" }}>
                                    &lt;List>
                                        &lt;List.Item>&lt;strong>Topic:&lt;/strong> {selectedTopic ? selectedTopic.topic : "Null"}&lt;/List.Item>
                                        &lt;List.Item>&lt;strong>Sentiment:&lt;/strong> {selectedSentiment ? selectedSentiment.sentiment : "Null"}&lt;/List.Item>
                                    &lt;/List>
                                    &lt;a href="#" onClick={() => this.resetSelection()}>Reset&lt;/a>
                                &lt;/Segment>
                            &lt;/Grid.Column>
                        &lt;/Grid.Row>
                        &lt;Grid.Row>
                            &lt;Grid.Column mobile={16} tablet={16} computer={7}>
                                &lt;Card fluid className="result">
                                    &lt;Card.Content header={"Timeline"} />
                                    &lt;Card.Content className={'card-body'}>
                                        {this.state.selectedTopic ?
                                            &lt;ResponsiveContainer height={500}>
                                                &lt;ComposedChart height={500} data={aggregateDate}
                                                    margin={{ top: 5, right: 30, left: 20, bottom: 5 }}>
                                                    &lt;XAxis dataKey="created" tickFormatter={this.formatDate} />
                                                    &lt;YAxis type="number" domain={['auto', 'auto']} />
                                                    &lt;CartesianGrid />
                                                    &lt;Tooltip />
                                                    &lt;Legend />
                                                    {/*&lt;Bar dataKey='average_sentimentValue' barSize={20} fill='#413ea0'>
                                                        {
                                                            aggregateDate.map((entry, index) => {
                                                                return (&lt;Cell key={`cell-${index}`} fill={entry.average_sentimentValue &lt; 35.00 ? "#e74c3c" : entry.average_sentimentValue > 85.00 ? "#2ecc71" : "#f1c40f"} />)
                                                            })
                                                        }
                                                    &lt;/Bar>*/}
                                                    &lt;Line type="monotone" dataKey="count_created" stroke="#8884d8" />
                                                &lt;/ComposedChart>
                                            &lt;/ResponsiveContainer >
                                            : ""}
                                    &lt;/Card.Content>
                                &lt;/Card>
                            &lt;/Grid.Column>
                            &lt;Grid.Column mobile={16} tablet={16} computer={7}>
                                &lt;Card fluid className="result">
                                    &lt;Card.Content header={"Poisson"} />
                                    &lt;Card.Content className={'card-body'}>
                                        {this.state.selectedTopic ?
                                            &lt;ResponsiveContainer height={500}>
                                                &lt;ComposedChart height={500} data={selectedTrendGraph}
                                                    margin={{ top: 5, right: 30, left: 20, bottom: 5 }}>
                                                    &lt;XAxis dataKey="date" tickFormatter={this.formatDate} />
                                                    &lt;YAxis type="number" domain={['auto', 'dataMax']} />
                                                    &lt;CartesianGrid />
                                                    &lt;Tooltip />
                                                    &lt;Legend />
                                                    &lt;Line type="monotone" dataKey="poisson" stroke="#8884d8" />
                                                &lt;/ComposedChart>
                                            &lt;/ResponsiveContainer >
                                            : ""}
                                    &lt;/Card.Content>
                                &lt;/Card>
                            &lt;/Grid.Column>
                        &lt;/Grid.Row>
                        {withLDA ? &lt;Grid.Row>
                            &lt;Grid.Column mobile={16} tablet={14} computer={14}>
                                &lt;Card fluid>
                                    &lt;Card.Content>
                                        &lt;Card.Header>LDA HTML&lt;/Card.Header>
                                    &lt;/Card.Content>
                                    &lt;Card.Content>
                                        &lt;iframe src="http://localhost:8080/ldaresult" frameBorder="0" style={{ width: "100%", height: "900px" }}>&lt;/iframe>
                                    &lt;/Card.Content>
                                &lt;/Card>
                            &lt;/Grid.Column>
                        &lt;/Grid.Row> : null}
                        &lt;Grid.Row>
                            &lt;Grid.Column mobile={16} tablet={14} computer={14}>
                                &lt;Card fluid className="result">
                                    &lt;Card.Content>
                                        &lt;Card.Header>Raw Tweets&lt;/Card.Header>
                                    &lt;/Card.Content>
                                    &lt;Card.Content className={'card-body'}>
                                        {this.state.selectedTopic ? &lt;Table fixed stackable>
                                            &lt;Table.Header>
                                                &lt;Table.Row>
                                                    &lt;Table.HeaderCell>Id&lt;/Table.HeaderCell>
                                                    &lt;Table.HeaderCell>Topic&lt;/Table.HeaderCell>
                                                    &lt;Table.HeaderCell>Sentiment&lt;/Table.HeaderCell>
                                                    &lt;Table.HeaderCell>Topic Probability&lt;/Table.HeaderCell>
                                                    &lt;Table.HeaderCell>Message&lt;/Table.HeaderCell>
                                                    &lt;Table.HeaderCell>Hashtags&lt;/Table.HeaderCell>
                                                    &lt;Table.HeaderCell>Created&lt;/Table.HeaderCell>
                                                &lt;/Table.Row>
                                            &lt;/Table.Header>

                                            &lt;Table.Body>
                                                {result.slice().filter(element => {
                                                    if (this.state.selectedSentiment) {
                                                        return (element.topicId == selectedTopic.topicId &amp;&amp; element.sentiment == selectedSentiment.sentiment)
                                                    } else {
                                                        return (element.topicId == selectedTopic.topicId)
                                                    }

                                                }).slice().map(tweet => {
                                                    return (&lt;Table.Row key={`table-row-${tweet.id}`}>
                                                        &lt;Table.Cell>{tweet.id}&lt;/Table.Cell>
                                                        &lt;Table.Cell>{tweet.topic}&lt;/Table.Cell>
                                                        &lt;Table.Cell>{tweet.sentiment}&lt;/Table.Cell>
                                                        &lt;Table.Cell>{tweet.topicProbability}&lt;/Table.Cell>
                                                        &lt;Table.Cell>{tweet.message}&lt;/Table.Cell>
                                                        &lt;Table.Cell>{tweet.hashtags}&lt;/Table.Cell>

                                                        &lt;Table.Cell>{moment(tweet.created).format("DD-MM-YYYY HH:mm:ss")}&lt;/Table.Cell>
                                                    &lt;/Table.Row>)
                                                })}
                                            &lt;/Table.Body>
                                        &lt;/Table> : ""}
                                    &lt;/Card.Content>
                                &lt;/Card>
                            &lt;/Grid.Column>
                        &lt;/Grid.Row>
                    &lt;/Grid>
                &lt;/div >
            )
        } else {
            return (
                &lt;Segment basic>
                    No data
                &lt;/Segment>
            );

        }
    }
}


Result.propTypes = {
    /** {Array} Array with the result containing the dynamic topic detection*/
    result: PropTypes.array,
}

export default Result;</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.3</a> on Sat Sep 02 2017 00:30:52 GMT+0200 (CEST) using the Minami theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
